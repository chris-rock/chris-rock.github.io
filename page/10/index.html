<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <meta name="google-site-verification" content="iplyfI0Y6pOe8NsNYwwrKe-QfSYamSeEhQiDFh93NiU">
    <title>chris-rock
    </title>
    <link rel="alternate" href="http://lollyrock.com/feed.xml" type="application/rss+xml" title="fun &amp; sun">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic|Anonymous+Pro:400,700,400italic,700italic|Merriweather:400,700,300">
    <link rel="stylesheet" href="/css/main.css">
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-50992958-1', 'lollyrock.com');
      ga('send', 'pageview');
    </script>
    <script type="text/javascript">
      !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
      
    </script>
  </head>
  <body>
    <header class="header">
      <div class="content-wrap">
        <div class="logo">
          <h1><a href="http://lollyrock.com">chris-rock</a></h1>
          <p class="description text-center">Christoph Hartmann |  <a href="https://twitter.com/chri_hartmann">@chri_hartmann </a>| <a href="https://github.com/chris-rock">chris-rock</a></p>
        </div>
      </div>
    </header>
    <div id="content">
      <div class="content-wrap">
        <article class="article intro">
          <header>
            <p class="date"><span>14. May 2014</span></p>
            <h2><a href="/articles/how-to-harden-a-new-server/">How to harden a new server with Chef</a></h2>
          </header>
          <section class="content"><p>Deutsche Telekom developed scripts in Chef and Puppet to harden servers according to well-known guidelines like bettercrypto and internal guidelines at Deutsche Telekom. More information is available at the project page of the <a href="http://hardening.io/">Hardening Framework</a>. Disclosure: I am core developer at this&nbsp;project.</p>
<p>Today we cook with <a href="http://matschaffer.github.io/knife-solo/">knife-solo</a> and harden a fresh copy of Ubuntu 14.04. The process of hardening a server is quite difficult and takes a lot of knowledge and experience. Even the most-experienced administrators rely on guidelines to meet the best&nbsp;practices.</p>
<p>Since we live in a cloud world by now, <a href="http://arlimus.github.io/">Dominik Richter</a>, Patrick Meier and myself invented the <code>Hardening Framework</code>. It is a set of cookbooks that help you to secure your server with well-known&nbsp;rules. </p>
<p>The following steps illustrate the hardening process of a fresh server with nothing than a base Linux&nbsp;system.</p>
<p>I assume you have <a href="http://www.getchef.com/downloads/chef-dk/mac/">Chef Development Kit</a> or <a href="http://www.getchef.com/chef/install/">Chef</a> and <a href="http://berkshelf.com/">Berkshelf</a> on your&nbsp;machine.</p>
<p>At first of all we need to install <code>knife-solo</code> via <code>gem</code> on your&nbsp;workstation.</p>
<pre><code class="lang-bash">∅&gt; sudo gem install knife-solo
Fetching: method_source-0.8.2.gem (100%)
Successfully installed method_source-0.8.2
Fetching: slop-3.5.0.gem (100%)
Successfully installed slop-3.5.0
Fetching: coderay-1.1.0.gem (100%)
Successfully installed coderay-1.1.0
Fetching: pry-0.10.0.pre2.gem (100%)
Successfully installed pry-0.10.0.pre2
Fetching: chef-zero-2.0.2.gem (100%)
Successfully installed chef-zero-2.0.2
Fetching: diff-lcs-1.2.5.gem (100%)
Successfully installed diff-lcs-1.2.5
Fetching: highline-1.6.21.gem (100%)
Successfully installed highline-1.6.21
Fetching: net-ssh-gateway-1.2.0.gem (100%)
Successfully installed net-ssh-gateway-1.2.0
Fetching: net-ssh-multi-1.2.0.gem (100%)
Successfully installed net-ssh-multi-1.2.0
Fetching: mime-types-1.25.1.gem (100%)
Successfully installed mime-types-1.25.1
Fetching: rest-client-1.6.8.rc1.gem (100%)
Successfully installed rest-client-1.6.8.rc1
Fetching: ipaddress-0.8.0.gem (100%)
Successfully installed ipaddress-0.8.0
Fetching: mixlib-shellout-1.4.0.gem (100%)
Successfully installed mixlib-shellout-1.4.0
Fetching: mixlib-config-2.1.0.gem (100%)
Successfully installed mixlib-config-2.1.0
Fetching: mixlib-cli-1.5.0.gem (100%)
Successfully installed mixlib-cli-1.5.0
Fetching: systemu-2.5.2.gem (100%)
Successfully installed systemu-2.5.2
Fetching: ohai-7.0.4.gem (100%)
Successfully installed ohai-7.0.4
Fetching: chef-11.14.0.alpha.2.gem (100%)
Successfully installed chef-11.14.0.alpha.2
Fetching: knife-solo-0.4.1.gem (100%)
Thanks <span class="keyword">for</span> installing knife-solo!

If you run into any issues please <span class="built_in">let</span> us know at:
  https://github.com/matschaffer/knife-solo/issues

If you are upgrading knife-solo please uninstall any old versions by
running `gem clean knife-solo` to avoid any errors.

See http://bit.ly/<span class="caps">CHEF</span>-3255 <span class="keyword">for</span> more information on the knife bug
that causes this.
Successfully installed knife-solo-0.4.1
Installing ri documentation <span class="keyword">for</span> chef-11.14.0.alpha.2
Installing ri documentation <span class="keyword">for</span> chef-zero-2.0.2
invalid options: -SNw2
(invalid options are ignored)
Installing ri documentation <span class="keyword">for</span> coderay-1.1.0
Installing ri documentation <span class="keyword">for</span> diff-lcs-1.2.5
Installing ri documentation <span class="keyword">for</span> highline-1.6.21
Installing ri documentation <span class="keyword">for</span> ipaddress-0.8.0
Installing ri documentation <span class="keyword">for</span> knife-solo-0.4.1
Installing ri documentation <span class="keyword">for</span> method_source-0.8.2
Installing ri documentation <span class="keyword">for</span> mime-types-1.25.1
Installing ri documentation <span class="keyword">for</span> mixlib-cli-1.5.0
Installing ri documentation <span class="keyword">for</span> mixlib-config-2.1.0
Installing ri documentation <span class="keyword">for</span> mixlib-shellout-1.4.0
Installing ri documentation <span class="keyword">for</span> net-ssh-gateway-1.2.0
Installing ri documentation <span class="keyword">for</span> net-ssh-multi-1.2.0
Installing ri documentation <span class="keyword">for</span> ohai-7.0.4
Installing ri documentation <span class="keyword">for</span> pry-0.10.0.pre2
Installing ri documentation <span class="keyword">for</span> rest-client-1.6.8.rc1
Installing ri documentation <span class="keyword">for</span> slop-3.5.0
Installing ri documentation <span class="keyword">for</span> systemu-2.5.2
19 gems installed
∅&gt;
</code></pre>
<p>As a next step we need to download the <code>hardening-kitchen</code>. This comes with a set of hardening cookbooks and works out of the box. You’re free to extend the kitchen with your own&nbsp;cookbooks.</p>
<pre><code class="lang-bash">git <span class="built_in">clone</span> https://github.com/TelekomLabs/example-chef-hardening.git
<span class="built_in">cd</span> example-chef-hardening
</code></pre>
<p>By now, the workstation is ready and we are able to bootstrap our server with Chef and our hardening&nbsp;cookbooks.</p>
<pre><code class="lang-bash">knife solo bootstrap ubuntu@hardening.tlabscloud.com nodes/default.json 
Bootstrapping Chef...
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 15934  100 15934    0     0  21847      0 --:--:-- --:--:-- --:--:-- 21857
Downloading Chef 11.10.4 <span class="keyword">for</span> ubuntu...
downloading https://www.opscode.com/chef/metadata?v=11.10.4&amp;prerelease=<span class="literal">false</span>&amp;nightlies=<span class="literal">false</span>&amp;p=ubuntu&amp;pv=14.04&amp;m=x86_64
  to file /tmp/install.sh.30630/metadata.txt
trying wget...
url https://opscode-omnibus-packages.s3.amazonaws.com/ubuntu/13.04/x86_64/chef_11.10.4-1.ubuntu.13.04_amd64.deb
md5 25e27eeaff3304df354e735a56005f04
sha256  98fc3ef27419ec45281306b160e5f1e736a9846ad9060a151046d5a29c49af6b
yolo    <span class="literal">true</span>
downloaded metadata file looks valid...
downloading https://opscode-omnibus-packages.s3.amazonaws.com/ubuntu/13.04/x86_64/chef_11.10.4-1.ubuntu.13.04_amd64.deb
  to file /tmp/install.sh.30630/chef_11.10.4-1.ubuntu.13.04_amd64.deb
trying wget...
Comparing checksum with sha256sum...

<span class="caps">WARNING</span>: Chef-Client has not been regression tested on this O/S Distribution
WARNING: Do not use this configuration <span class="keyword">for</span> Production Applications.  Use at your own risk.

Installing Chef 11.10.4
installing with dpkg...
dpkg: warning: downgrading chef from 11.12.4-1 to 11.10.4-1.ubuntu.13.04
(Reading database ... 62386 files and directories currently installed.)
Preparing to unpack .../chef_11.10.4-1.ubuntu.13.04_amd64.deb ...
Unpacking chef (11.10.4-1.ubuntu.13.04) over (11.12.4-1) ...
Setting up chef (11.10.4-1.ubuntu.13.04) ...
Thank you <span class="keyword">for</span> installing Chef!
Running Chef on hardening.tlabscloud.com...
Installing Berkshelf cookbooks to <span class="string">'cookbooks'</span>...
Installing os-hardening (1.0.1) from site: <span class="string">'https://supermarket.chef.io/api/v1/cookbooks'</span>
Installing ssh-hardening (1.0.0) from site: <span class="string">'https://supermarket.chef.io/api/v1/cookbooks'</span>
Using sysctl (0.3.4)
Using ntp (1.6.2)
Using apt (2.3.8)
Using yum (2.4.4)
Uploading the kitchen...
Generating solo config...
Running Chef...
Starting Chef Client, version 11.10.4
[2014-05-14T14:53:23+00:00] <span class="caps">WARN</span>: unable to detect ip6address
Compiling Cookbooks...
[2014-05-14T14:53:23+00:00] WARN: encrypted_data_bag_Secret is <span class="built_in">set</span> but file does not exist. Unsetting
/home/ubuntu/chef-solo/cookbooks-2/chef-solo-search/libraries/search.rb:57: warning: already initialized constant PARSER_LOADED

...

Chef Client finished, 10/45 resources updated <span class="keyword">in</span> 4.206405118 seconds
</code></pre>
<p>In less than 5 minutes, a new server is hardened for the core system and ssh. Be aware that your server still needs some configuration in order to be production ready. For that I recommend&nbsp;to:</p>
<ul>
<li>Configure  your firewall&nbsp;properly</li>
<li>Install  critical&nbsp;patches</li>
<li>Use patch&nbsp;management</li>
<li>Use system&nbsp;monitoring</li>
</ul>
<p>More information is available&nbsp;at:</p>
<ul>
<li><a href="http://dev-sec.io/">http://dev-sec.io/</a></li>
<li><a href="http://vulcanosec.com/">http://vulcanosec.com/</a></li>
<li><a href="https://github.com/dev-sec/hardening">https://github.com/dev-sec/hardening</a></li>
<li><a href="https://supermarket.chef.io/cookbooks/os-hardening">https://supermarket.chef.io/cookbooks/os-hardening</a></li>
<li><a href="https://supermarket.chef.io/cookbooks/ssh-hardening">https://supermarket.chef.io/cookbooks/ssh-hardening</a></li>
</ul>
<p>Happy&nbsp;Hardening!</p>
<p>If you have any questions contact me via <a href="https://twitter.com/chri_hartmann">Twitter @chri_hartmann</a> or <a href="https://github.com/chris-rock">Github</a></p>
<p>Commercial support for all hardening cookbooks is available via <a href="http://vulcanosec.com/">Vulcano&nbsp;Security</a></p>

          </section>
        </article>
        <article class="article intro">
          <header>
            <p class="date"><span>06. April 2014</span></p>
            <h2><a href="/articles/nodejs-sha512/">SHA 512 Hashs with nodejs</a></h2>
          </header>
          <section class="content"><p>Quite often you need to encrypt files. Recently I updated an application from encryption to <a href="http://en.wikipedia.org/wiki/Authenticated_encryption">authenticated encryption</a> and used the encrypt-then-mac&nbsp;approach.</p>
<p>Update: I created a node module that simplifies the process for you: <a href="https://github.com/chris-rock/password-hasher">password-hasher</a></p>
<p>To create a hash from strings you just need a few lines in&nbsp;nodejs:</p>
<pre><code class="lang-javascript">    <span class="comment">// generate a hash from string</span>
    <span class="keyword">var</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>),
        text = <span class="string">'hello bob'</span>,
        key = <span class="string">'mysecret key'</span>

    <span class="comment">// create hahs</span>
    <span class="keyword">var</span> hash = crypto.createHmac(<span class="string">'sha512'</span>, key)
    hash.update(text)
    <span class="keyword">var</span> value = hash.digest(<span class="string">'hex'</span>)

    <span class="comment">// print result</span>
    <span class="built_in">console</span>.log(value);
</code></pre>
<p>The great thing about the nodejs implementation of <code>Hash</code> is the possibility to stream data directly into the&nbsp;hash:</p>
<pre><code class="lang-javascript">    <span class="comment">// generate a hash from file stream</span>
    <span class="keyword">var</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>),
        fs = <span class="built_in">require</span>(<span class="string">'fs'</span>),
        key = <span class="string">'mysecret key'</span>

    <span class="comment">// open file stream</span>
    <span class="keyword">var</span> fstream = fs.createReadStream(<span class="string">'./test/hmac.js'</span>);
    <span class="keyword">var</span> hash = crypto.createHash(<span class="string">'sha512'</span>, key);
    hash.setEncoding(<span class="string">'hex'</span>);

    <span class="comment">// once the stream is done, we read the values</span>
    fstream.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
        hash.end();
        <span class="comment">// print result</span>
        <span class="built_in">console</span>.log(hash.read());
    });

    <span class="comment">// pipe file to hash generator</span>
    fstream.pipe(hash);
</code></pre>
<p>Happy&nbsp;Hashing.</p>
<p>If you have any questions contact me via <a href="https://twitter.com/chri_hartmann">Twitter @chri_hartmann</a> or <a href="https://github.com/chris-rock">Github</a></p>
<p>See&nbsp;also:</p>
<ul>
<li><a href="http://lollyrock.com/articles/nodejs-encryption/">Encrypt and decrypt content with&nbsp;Nodejs</a></li>
<li><a href="http://lollyrock.com/articles/express4-file-upload/">Simple file uploads with Express&nbsp;4</a></li>
<li><a href="http://lollyrock.com/articles/content-security-policy/">Applied Content Security Policy for Nginx and&nbsp;Nodejs</a></li>
<li><a href="http://arlimus.github.io/articles/ready.for.es6/">Ready for&nbsp;<span class="caps">ES6</span>?</a></li>
</ul>

          </section>
        </article>
        <article class="article intro">
          <header>
            <p class="date"><span>03. April 2014</span></p>
            <h2><a href="/articles/glance-image-create/">Open Stack Glance Image Create</a></h2>
          </header>
          <section class="content"><p>The newest version of Ubuntu is out and we need to upload the latest version to Open Stack. Of course we try to save our bandwith. There we use <code>-copy-from</code> instead of <code>--file openstack_image.img</code>:</p>
<pre><code>glance image-create --name &#39;Ubuntu 14.04 LTS&#39; \
  --container-format bare \
  --disk-format qcow2 \
  --is-public true \
  --copy-from http://uec-images.ubuntu.com/releases/14.04/release/ubuntu-14.04-server-cloudimg-amd64-disk1.img


+------------------+--------------------------------------+
| Property         | Value                                |
+------------------+--------------------------------------+
| checksum         | None                                 |
| container_format | bare                                 |
| created_at       | 2014-04-02T13:16:20                  |
| deleted          | False                                |
| deleted_at       | None                                 |
| disk_format      | qcow2                                |
| id               | aa5ab6de-e461-4330-136e-fb149802bdc0 |
| is_public        | True                                 |
| min_disk         | 0                                    |
| min_ram          | 0                                    |
| name             | Ubuntu 14.04 LTS Beta 1              |
| owner            | 9ab2f1a7ca521eee9c8de5a14567d377     |
| protected        | False                                |
| size             | 261095936                            |
| status           | queued                               |
| updated_at       | 2014-04-02T13:16:20                  |
+------------------+--------------------------------------+
</code></pre><p>If you have any questions contact me via <a href="https://twitter.com/chri_hartmann">Twitter @chri_hartmann</a> or <a href="https://github.com/chris-rock">Github</a></p>

          </section>
        </article>
      </div>
    </div>
    <footer>
      <div class="content-wrap">
        <div class="nav"><a href="/page/9/">« Newer</a><a href="/page/11/">Next page »</a>
        </div>
        <section class="about">
        </section>
        <section class="copy">
          <p>&copy; 2018 Christoph Hartmann &mdash; powered by&nbsp;<a href="https://github.com/jnordberg/wintersmith">Wintersmith</a>
          </p>
        </section>
      </div>
    </footer>
  </body>
</html>