<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <meta name="google-site-verification" content="iplyfI0Y6pOe8NsNYwwrKe-QfSYamSeEhQiDFh93NiU">
    <title>InSpec for Docker - chris-rock
    </title>
    <link rel="alternate" href="http://lollyrock.com/feed.xml" type="application/rss+xml" title="fun &amp; sun">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic|Anonymous+Pro:400,700,400italic,700italic|Merriweather:400,700,300">
    <link rel="stylesheet" href="/css/main.css">
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-50992958-1', 'lollyrock.com');
      ga('send', 'pageview');
    </script>
    <script type="text/javascript">
      !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
      
    </script>
  </head>
  <body class="article-detail">
    <header class="header">
      <div class="content-wrap">
        <h1>InSpec for Docker</h1>
        <p class="author">Written by <span class="author"><a href="mailto:chris@lollyrock.com">Christoph Hartmann</a></span>
        </p>
      </div>
    </header>
    <div id="content">
      <div class="content-wrap">
        <article class="article">
          <section class="content"><p>Docker environments enable you to manage fast-moving infrastructure. The faster you move, the better your test environment needs to be. InSpec provides that capability. With the recent addition of 3 new resources: <code>docker</code>, <code>docker_image</code> and a <code>docker_container</code>, it became even easier to verify docker hosts and docker containers. This blog post demonstrates how to use InSpec to verify your Docker&nbsp;environments.</p>
<h2 id="overview">Overview</h2>
<p><center><img src="/articles/inspec-for-docker/inspec-docker.png" alt="" title="Docker Architecture Overview" width="700px"></center></p>

<p>Before I am talking about docker infrastructure testing, I need to explain the different parts of the docker universe&nbsp;quickly.</p>
<p><center style="font-size: 14px"><img src="/articles/inspec-for-docker/docker-architecture.svg" alt="" title="Docker Architecture Overview" width="700px">Source: <a href="https://docs.docker.com/engine/docker-overview/#docker-architecture">https://docs.docker.com/engine/docker-overview/#docker-architecture</a></center></p>

<p>A docker host is the runtime environment (docker cli + docker daemon) that manages docker images and containers on a machine. Therefore it helps to manages the complete lifecycle of a container and provides a nice <span class="caps">CLI</span> to interact. The docker daemon can start multiple containers in parallel. A good read to understand containers is <a href="https://news.ycombinator.com/item?id=13982620">Containers vs. Zones vs. Jails vs. VMs</a>.</p>
<p>InSpec allows you to scan both, the host and the running container. At first, I am demonstrating the use of InSpec with a running container to ensure the container is configured correctly. Afterwards, I am going to talk about 3 InSpec resources that help you to verify a docker host&nbsp;environment:</p>
<ul>
<li><code>docker container</code></li>
<li><code>docker image</code></li>
<li><code>docker</code></li>
</ul>
<p>Those resources are heavily used in <a href="https://github.com/dev-sec/cis-docker-benchmark">DevSec’s <span class="caps">CIS</span> Docker Benchmark </a> to ensure best-practices security configuration for docker&nbsp;hosts.</p>
<h2 id="verify-a-running-container">Verify a running&nbsp;container</h2>
<p>The simplest use-case is to verify a running docker container. Just start a new container&nbsp;by</p>
<pre><code>docker run -it alpine /bin/sh
</code></pre><p>Now, we can use InSpec to run the <a href="https://github.com/dev-sec/linux-baseline">DevSec Linux Baseline</a> against that&nbsp;container:</p>
<pre><code>$ inspec exec https://github.com/dev-sec/linux-baseline -t docker://ca2dbee25ddc
Profile: DevSec Linux Security Baseline (linux-baseline)
Version: 2.0.1
Target:  docker://ca2dbee25ddca24f453005a15cd64f1004fbe6f974df957658fcdf6d1fa6331e

  ✔  os-01: Trusted hosts login
     ✔  Command find / -name &#39;.rhosts&#39; stdout should be empty
     ✔  Command find / -name &#39;hosts.equiv&#39;  stdout should be empty
  ×  os-02: Check owner and permissions for /etc/shadow (1 failed)
     ✔  File /etc/shadow should exist
     ✔  File /etc/shadow should be file
     ✔  File /etc/shadow should be owned by &quot;root&quot;
     ✔  File /etc/shadow should not be executable
     ✔  File /etc/shadow should be writable by owner
     ✔  File /etc/shadow should be readable by owner
     ✔  File /etc/shadow should not be readable by other
     ×  File /etc/shadow group should eq nil

     expected: nil
          got: &quot;shadow&quot;

     (compared using ==)

...

  ✔  sysctl-31a: Secure Core Dumps - dump settings
    ✔  Kernel Parameter fs.suid_dumpable value should cmp == /(0|2)/
  ↺  sysctl-31b: Secure Core Dumps - dump path
    ↺  Skipped control due to only_if condition.
  ✔  sysctl-32: kernel.randomize_va_space
    ✔  Kernel Parameter kernel.randomize_va_space value should eq 2
  ✔  sysctl-33: CPU No execution Flag or Kernel ExecShield
    ✔  /proc/cpuinfo Flags should include NX

  Profile Summary: 20 successful, 23 failures, 7 skipped
  Test Summary: 46 successful, 56 failures, 9 skipped
</code></pre><p>You can write your own tests and run those against a running container, too. Further information about the available InSpec resources is available at <a href="https://www.inspec.io/docs/">InSpec&nbsp;Docs</a></p>
<h2 id="how-to-use-docker_container-">How to use&nbsp;‘docker_container’</h2>
<p>The <code>docker_container</code> resource helps you to verify running container. For the following test, I am going to start a new postgres&nbsp;database:</p>
<pre><code>docker run --name some-postgres -e POSTGRES_PASSWORD=mysecretpassword -d  -p 5432:5432 postgres
</code></pre><p>I’d like to write a test that ensures the container <code>some-postgres</code> runs and the port is mapped. A simple InSpec test can do the&nbsp;trick:</p>
<pre><code>describe docker_container(&#39;some-postgres&#39;) do
  it { should exist }
  it { should be_running }
  its(&#39;repo&#39;) { should eq &#39;postgres&#39; }
  its(&#39;ports&#39;) { should eq &quot;0.0.0.0:5432-&gt;5432/tcp&quot; }
  its(&#39;command&#39;) { should eq &#39;docker-entrypoint.sh postgres&#39; }
end
</code></pre><p>I am going to run that test that quickly in InSpec Shell, but you can use the same test in a <code>test.rb</code> and run <code>inspec exec test.rb</code>.</p>
<pre><code>inspec shell
Welcome to the interactive InSpec Shell
To find out how to use it, type: help

You are currently running on:

    OS platform:  mac_os_x
    OS family:  darwin
    OS release: 10.12.4

inspec&gt; describe docker_container(&#39;some-postgres&#39;) do
inspec&gt;   it { should exist }  
inspec&gt;   it { should be_running }  
inspec&gt;   its(&#39;repo&#39;) { should eq &#39;postgres&#39; }  
inspec&gt;   its(&#39;ports&#39;) { should eq &quot;0.0.0.0:5432-&gt;5432/tcp&quot; }  
inspec&gt;   its(&#39;command&#39;) { should eq &#39;docker-entrypoint.sh postgres&#39; }  
inspec&gt; end  

Profile: inspec-shell
Version: (not specified)

  Docker Container
     ✔  some-postgres should exist
     ✔  some-postgres should be running
     ✔  some-postgres repo should eq &quot;postgres&quot;
     ✔  some-postgres ports should eq &quot;0.0.0.0:5432-&gt;5432/tcp&quot;
     ✔  some-postgres command should eq &quot;docker-entrypoint.sh postgres&quot;

Test Summary: 5 successful, 0 failures, 0 skipped
</code></pre><p>In case you want to verify a specific container id, you can do that as&nbsp;well:</p>
<pre><code>describe docker_container(id: &#39;a3df5ff6740f&#39;) do
  it { should exist }
  it { should be_running }
end
</code></pre><h2 id="how-to-use-docker_image-">How to use&nbsp;‘docker_image’</h2>
<p>Another use-case I am seeing very often is to ensure a specific Docker image is not used in your environment anymore. I am going to use Ubuntu 12.04 as an example, since it went <a href="http://fridge.ubuntu.com/2017/03/15/ubuntu-12-04-precise-pangolin-reaches-end-of-life-on-april-28-2017/">end of life</a> recently. The following test ensures that <code>u12:latest</code> image is available on your docker&nbsp;host:</p>
<pre><code>describe docker_image(&#39;u12:latest&#39;) do
  it { should_not exist }
end
</code></pre><p>Lets run it in InSpec Shell&nbsp;quickly:</p>
<pre><code>inspec shell
Welcome to the interactive InSpec Shell
To find out how to use it, type: help

You are currently running on:

    OS platform:  mac_os_x
    OS family:  darwin
    OS release: 10.12.4

inspec&gt; describe docker_image(&#39;u12:latest&#39;) do
inspec&gt;   it { should_not exist }  
inspec&gt; end  

Profile: inspec-shell
Version: (not specified)

  Docker Image
     ✔  u12:latest should not exist

Test Summary: 1 successful, 0 failures, 0 skipped
inspec&gt;
</code></pre><p>The <code>docker_image</code> resource can also be used to verify a specific image&nbsp;id:</p>
<pre><code>describe docker_image(&#39;alpine:latest&#39;) do
  it { should exist }
  its(&#39;id&#39;) { should eq &#39;sha256:4a415e3663882fbc554ee830889c68a33b3585503892cc718a4698e91ef2a526&#39; }
  its(&#39;image&#39;) { should eq &#39;alpine:latest&#39; }
  its(&#39;repo&#39;) { should eq &#39;alpine&#39; }
  its(&#39;tag&#39;) { should eq &#39;latest&#39; }
end
</code></pre><p>In addition you could also verify that no container is using the <code>u12:latest</code> image. We ask InSpec to return all images of the containers. This will return a list of images used by the containers. As a next step, we just have to ensure the specific image is not used&nbsp;anymore.</p>
<pre><code>describe docker.containers do
  its(&#39;images&#39;) { should_not include &#39;u12:latest&#39; }
end
</code></pre><h2 id="more-advanced-used-cases-with-docker-resource">More advanced used cases with ‘docker’&nbsp;resource</h2>
<p>The <code>docker</code> resource is more complex to use than <code>docker_image</code> and <code>docker_container</code>, but allows you to implement more complex query scenarios. It provides 4 key methods to fetch more information about the docker&nbsp;host:</p>
<ul>
<li><code>containers</code> returns all running and exited containers by running <code>docker ps -a --no-trunc</code> under the&nbsp;hood</li>
<li><code>images</code> returns all locally available images by running <code>docker images -a --no-trunc</code></li>
<li><code>version</code> is the parsed content of <code>docker version</code></li>
<li><code>object(id)</code> returns information about a docker object and parses the output from <code>docker inspect id</code></li>
</ul>
<p><strong>Docker&nbsp;Containers</strong></p>
<pre><code>describe docker.containers do
  its(&#39;images&#39;) { should_not include &#39;u12:latest&#39; }
end
</code></pre><p>Let us inspec the <code>docker</code> resource with InSpec Shell. This will show two containers, one is already exited and another one is still&nbsp;running:</p>
<pre><code>$ inspec shell
dockeWelcome to the interactive InSpec Shell
To find out how to use it, type: help

You are currently running on:

    OS platform:  mac_os_x
    OS family:  darwin
    OS release: 10.12.4

inspec&gt; docker.containers.entries
=&gt; [docker.containers.entries
=&gt; [#&lt;struct
  command=&quot;\&quot;/bin/sh\&quot;&quot;,
  id=&quot;ca2dbee25ddca24f453005a15cd64f1004fbe6f974df957658fcdf6d1fa6331e&quot;,
  image=&quot;alpine&quot;,
  labels=&quot;&quot;,
  localvolumes=&quot;0&quot;,
  mounts=&quot;&quot;,
  names=&quot;keen_dijkstra&quot;,
  networks=&quot;bridge&quot;,
  ports=&quot;&quot;,
  runningfor=&quot;About an hour ago&quot;,
  size=&quot;0B&quot;,
  status=&quot;Exited (127) 13 seconds ago&quot;,
  exists?=nil,
  running?=nil&gt;,
 #&lt;struct
  command=&quot;\&quot;docker-entrypoint.sh postgres\&quot;&quot;,
  id=&quot;921f6363ceaa3c5253a31068a0c8cb7b3a78c1353cf6b4125c7a5460d4e8ce2a&quot;,
  image=&quot;postgres&quot;,
  labels=&quot;&quot;,
  localvolumes=&quot;1&quot;,
  mounts=&quot;afee92bcd2e8e84cccf884cd42443f0ff718789dca271e7497a308e22622514a&quot;,
  names=&quot;some-postgres&quot;,
  networks=&quot;bridge&quot;,
  ports=&quot;0.0.0.0:5432-&gt;5432/tcp&quot;,
  runningfor=&quot;3 hours ago&quot;,
  size=&quot;0B&quot;,
  status=&quot;Up 3 hours&quot;,
  exists?=nil,
  running?=nil&gt;]
</code></pre><p>The resource allows you to ask for all running&nbsp;containers:</p>
<pre><code>docker.containers.running?.entries
=&gt; [#&lt;struct
  command=&quot;\&quot;docker-entrypoint.sh postgres\&quot;&quot;,
  id=&quot;921f6363ceaa3c5253a31068a0c8cb7b3a78c1353cf6b4125c7a5460d4e8ce2a&quot;,
  image=&quot;postgres&quot;,
  labels=&quot;&quot;,
  localvolumes=&quot;1&quot;,
  mounts=&quot;afee92bcd2e8e84cccf884cd42443f0ff718789dca271e7497a308e22622514a&quot;,
  names=&quot;some-postgres&quot;,
  networks=&quot;bridge&quot;,
  ports=&quot;0.0.0.0:5432-&gt;5432/tcp&quot;,
  runningfor=&quot;3 hours ago&quot;,
  size=&quot;0B&quot;,
  status=&quot;Up 3 hours&quot;,
  exists?=nil,
  running?=nil&gt;]
</code></pre><p>You can also filter containers by the following fields: <code>commands</code>, <code>ids</code>, <code>images</code>, <code>labels</code>, <code>local_volumes</code>, <code>mounts</code>, <code>names</code>, <code>networks</code>, <code>ports</code>, <code>running_for</code>, <code>sizes</code>,<code>status</code>, <code>running?</code>,<code>exists?</code>. For example, if you want to verify the configuration for each container, you can do the following in&nbsp;InSpec:</p>
<pre><code># returns all container ids
docker.containers.ids.each do |id|
  # call docker inspect to retrieve detailed information about the container
  describe docker.object(id) do
    its(&#39;HostConfig.Privileged&#39;) { should cmp false }
  end
end
</code></pre><p>If you want to do the following for running containers, just say&nbsp;so:</p>
<pre><code># returns all running container ids
docker.containers.running?.ids.each do |id|
  # call docker inspect to retrieve detailed information about the container
  describe docker.object(id) do
    its(&#39;HostConfig.Privileged&#39;) { should cmp false }
  end
end
</code></pre><p>If you a looking for a specific&nbsp;container:</p>
<pre><code># returns all running container ids
docker.containers.where { names == &#39;some-postgres&#39; }.ids.each do |id|
  # call docker inspect to retrieve detailed information about the container
  describe docker.object(id) do
    its(&#39;HostConfig.Privileged&#39;) { should cmp false }
  end
end
</code></pre><p><strong>Docker&nbsp;Images</strong></p>
<p>Docker images can be inspected with a similar&nbsp;approach:</p>
<pre><code>describe docker.images do
  its(&#39;repositories&#39;) { should_not include &#39;inssecure_image&#39; }
end
</code></pre><p>You can also filter images by the following fields: <code>ids</code>, <code>repositories</code>, <code>tags</code>, <code>sizes</code>, <code>digests</code>, <code>created</code>, <code>created_since</code> and <code>exists?</code>.</p>
<p>If you want to verify that no image is using the <span class="caps">ADD</span> instruction in Dockerfile, you can iterate over all image ids and ask <code>docker history</code> if the <span class="caps">ADD</span> instruction was&nbsp;used:</p>
<pre><code>docker.images.ids.each do |id|
  describe command(&quot;docker history #{id}| grep &#39;ADD&#39;&quot;) do
    its(&#39;stdout&#39;) { should eq &#39;&#39; }
  end
end
</code></pre><p><strong>Docker&nbsp;Version</strong></p>
<p>InSpec allows you to verify the docker client and server version that is used on your machine. Behind the scenes, it is using the <code>docker version</code> command. This would return the following&nbsp;values:</p>
<pre><code>$ docker version
Client:
 Version:      17.05.0-ce-rc1
 API version:  1.29
 Go version:   go1.7.5
 Git commit:   2878a85
 Built:        Tue Apr 11 20:55:05 2017
 OS/Arch:      darwin/amd64

Server:
 Version:      17.05.0-ce-rc1
 API version:  1.29 (minimum version 1.12)
 Go version:   go1.7.5
 Git commit:   2878a85
 Built:        Tue Apr 11 20:55:05 2017
 OS/Arch:      linux/amd64
 Experimental: true
</code></pre><p>In InSpec Shell, you see the parsed&nbsp;values:</p>
<pre><code>inspec&gt; docker.version
=&gt; {&quot;Client&quot;=&gt;
  {&quot;Version&quot;=&gt;&quot;17.05.0-ce-rc1&quot;,
   &quot;ApiVersion&quot;=&gt;&quot;1.29&quot;,
   &quot;DefaultAPIVersion&quot;=&gt;&quot;1.29&quot;,
   &quot;GitCommit&quot;=&gt;&quot;2878a85&quot;,
   &quot;GoVersion&quot;=&gt;&quot;go1.7.5&quot;,
   &quot;Os&quot;=&gt;&quot;darwin&quot;,
   &quot;Arch&quot;=&gt;&quot;amd64&quot;,
   &quot;BuildTime&quot;=&gt;&quot;Tue Apr 11 20:55:05 2017&quot;},
 &quot;Server&quot;=&gt;
  {&quot;Version&quot;=&gt;&quot;17.05.0-ce-rc1&quot;,
   &quot;ApiVersion&quot;=&gt;&quot;1.29&quot;,
   &quot;MinAPIVersion&quot;=&gt;&quot;1.12&quot;,
   &quot;GitCommit&quot;=&gt;&quot;2878a85&quot;,
   &quot;GoVersion&quot;=&gt;&quot;go1.7.5&quot;,
   &quot;Os&quot;=&gt;&quot;linux&quot;,
   &quot;Arch&quot;=&gt;&quot;amd64&quot;,
   &quot;KernelVersion&quot;=&gt;&quot;4.9.21-moby&quot;,
   &quot;Experimental&quot;=&gt;true,
   &quot;BuildTime&quot;=&gt;&quot;Tue Apr 11 20:55:05 2017&quot;}}
</code></pre><p>Now, I am going to write a check that ensures docker is newer than <code>1.12</code></p>
<pre><code>describe docker.version do
  its(&#39;Server.Version&#39;) { should cmp &gt;= &#39;1.12&#39;}
  its(&#39;Client.Version&#39;) { should cmp &gt;= &#39;1.12&#39;}
end
</code></pre><p><strong>Docker&nbsp;Info</strong></p>
<p><code>docker.info</code> parses the output of <code>docker info</code>:</p>
<pre><code>docker info
Containers: 5
 Running: 1
 Paused: 0
 Stopped: 4
Images: 108
Server Version: 17.05.0-ce-rc1
....
</code></pre><p>Again, you can inspect all values in InSpec with InSpec&nbsp;Shell:</p>
<pre><code>inspec&gt; docker.info
=&gt; {&quot;ID&quot;=&gt;&quot;YMXQ:5C62:Q3AR:XV77:7LS6:O56G:A6VZ:V5LJ:WNNJ:UQTO:QKPB:K62P&quot;,
 &quot;Containers&quot;=&gt;5,
 &quot;ContainersRunning&quot;=&gt;1,
 &quot;ContainersPaused&quot;=&gt;0,
 &quot;ContainersStopped&quot;=&gt;4,
 &quot;Images&quot;=&gt;108,
 &quot;Driver&quot;=&gt;&quot;overlay2&quot;,
 &quot;DriverStatus&quot;=&gt;[[&quot;Backing Filesystem&quot;, &quot;extfs&quot;], [&quot;Supports d_type&quot;, &quot;true&quot;], [&quot;Native Overlay Diff&quot;, &quot;true&quot;]],
 &quot;SystemStatus&quot;=&gt;nil,
 &quot;Plugins&quot;=&gt;{&quot;Volume&quot;=&gt;[&quot;local&quot;], &quot;Network&quot;=&gt;[&quot;bridge&quot;, &quot;host&quot;, &quot;ipvlan&quot;, &quot;macvlan&quot;, &quot;null&quot;, &quot;overlay&quot;], &quot;Authorization&quot;=&gt;[]},
 &quot;MemoryLimit&quot;=&gt;true,
 &quot;SwapLimit&quot;=&gt;true,
 &quot;KernelMemory&quot;=&gt;true,
 &quot;CpuCfsPeriod&quot;=&gt;true,
 &quot;CpuCfsQuota&quot;=&gt;true,
 &quot;CPUShares&quot;=&gt;true,
 &quot;CPUSet&quot;=&gt;true,
 &quot;IPv4Forwarding&quot;=&gt;true,
 &quot;BridgeNfIptables&quot;=&gt;true,
 &quot;BridgeNfIp6tables&quot;=&gt;true,
 &quot;Debug&quot;=&gt;true,
 &quot;NFd&quot;=&gt;25,
 &quot;OomKillDisable&quot;=&gt;true,
</code></pre><p>Now, lets ensure we are not running more than 20 containers on a&nbsp;node:</p>
<pre><code>describe docker.info do
  its(&#39;ContainersRunning&#39;) { should cmp &lt;= 20 }
end
</code></pre><p>If Swarm is active, you could verify that you have only a limited amount of&nbsp;leaders:</p>
<pre><code>describe docker.info do
  its(&#39;Swarm.Managers&#39;) { should cmp &lt;= 3 }
end
</code></pre><p><strong>Docker&nbsp;Object</strong></p>
<p>Each docker object store multiple attributes. Docker allows you to see those values by running <code>docker inspect</code>. This data is parsed in InSpec too and can be used to verify entries for container and images&nbsp;objects:</p>
<pre><code>describe docker.object(container_id) do
  its(&#39;Configuration.Path&#39;) { should eq &#39;value&#39; }
end
</code></pre><p>Be aware that docker object is very complex and the output varies by object. An example output in InSpec shell looks&nbsp;like:</p>
<pre><code>inspec&gt; docker.object(&#39;921f6363ceaa3c5253a31068a0c8cb7b3a78c1353cf6b4125c7a5460d4e8ce2a&#39;)
=&gt; {&quot;Id&quot;=&gt;&quot;921f6363ceaa3c5253a31068a0c8cb7b3a78c1353cf6b4125c7a5460d4e8ce2a&quot;,
 &quot;Created&quot;=&gt;&quot;2017-04-29T11:27:45.846552618Z&quot;,
 &quot;Path&quot;=&gt;&quot;docker-entrypoint.sh&quot;,
 &quot;Args&quot;=&gt;[&quot;postgres&quot;],
 &quot;State&quot;=&gt;
  {&quot;Status&quot;=&gt;&quot;running&quot;,
   &quot;Running&quot;=&gt;true,
   &quot;Paused&quot;=&gt;false,
   &quot;Restarting&quot;=&gt;false,
   &quot;OOMKilled&quot;=&gt;false,
   &quot;Dead&quot;=&gt;false,
   &quot;Pid&quot;=&gt;18850,
   &quot;ExitCode&quot;=&gt;0,
   &quot;Error&quot;=&gt;&quot;&quot;,
   &quot;StartedAt&quot;=&gt;&quot;2017-04-29T11:27:46.414873644Z&quot;,
   &quot;FinishedAt&quot;=&gt;&quot;0001-01-01T00:00:00Z&quot;},
 &quot;Image&quot;=&gt;&quot;sha256:390220867755ef4d1351705130960605d14a44518149e89c674189eefcb09306&quot;,
 &quot;ResolvConfPath&quot;=&gt;&quot;/var/lib/docker/containers/921f6363ceaa3c5253a31068a0c8cb7b3a78c1353cf6b4125c7a5460d4e8ce2a/resolv.conf&quot;,
 &quot;HostnamePath&quot;=&gt;&quot;/var/lib/docker/containers/921f6363ceaa3c5253a31068a0c8cb7b3a78c1353cf6b4125c7a5460d4e8ce2a/hostname&quot;,
 &quot;HostsPath&quot;=&gt;&quot;/var/lib/docker/containers/921f6363ceaa3c5253a31068a0c8cb7b3a78c1353cf6b4125c7a5460d4e8ce2a/hosts&quot;,
 &quot;LogPath&quot;=&gt;&quot;/var/lib/docker/containers/921f6363ceaa3c5253a31068a0c8cb7b3a78c1353cf6b4125c7a5460d4e8ce2a/921f6363ceaa3c5253a31068a0c8cb7b3a78c1353cf6b4125c7a5460d4e8ce2a-json.log&quot;,
 &quot;Name&quot;=&gt;&quot;/some-postgres&quot;,
 &quot;AppArmorProfile&quot;=&gt;&quot;&quot;,
 `
</code></pre><h2 id="verify-secure-configuration">Verify secure&nbsp;configuration</h2>
<p>If you are going to run your own docker environment in production, you should make the additional work to harden the docker environment. The <a href="https://benchmarks.cisecurity.org/tools2/docker/CIS_Docker_1.13.0_Benchmark_v1.0.0.pdf"><span class="caps">CIS</span> Docker Benchmark</a> provides a detailed overview about all best-practices. Based on those guidelines, the <a href="http://atomic111.github.io/blog/inspec-cis-docker">DevSec Hardening Framework Team</a> implemented a machine-readable version that allows you to easily execute the tests. To execute the InSpec profile, just&nbsp;run:</p>
<pre><code>$ inspec exec https://github.com/dev-sec/cis-docker-benchmark
</code></pre><h2 id="conclusion">Conclusion</h2>
<p>This blog post covered various aspects of docker environment verification ranging from docker hosts to docker container. If you feel that something is missing, please let me&nbsp;know.</p>
<p>Stay secure,&nbsp;Chris</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://www.inspec.io/docs/reference/resources/docker/">InSpec docker&nbsp;resource</a></li>
<li><a href="https://www.inspec.io/docs/reference/resources/docker_container/">InSpec docker_container&nbsp;resource</a></li>
<li><a href="https://www.inspec.io/docs/reference/resources/docker_image/">InSpec docker_image&nbsp;resource</a></li>
<li><a href="https://github.com/dev-sec/cis-docker-benchmark">DevSec <span class="caps">CIS</span> Docker Benchmark&nbsp;Implementation</a></li>
<li><a href="https://benchmarks.cisecurity.org/tools2/docker/CIS_Docker_1.13.0_Benchmark_v1.0.0.pdf"><span class="caps">CIS</span> Docker Benchmark&nbsp;PDF</a></li>
<li><a href="https://github.com/chef/inspec/pull/1566">Docker Pull Request&nbsp;Resource</a></li>
</ul>
</section>
        </article>
      </div>
    </div>
    <footer>
      <div class="content-wrap">
        <div class="social center">
          <div class="network"><a href="javascript:window.location=%22http://news.ycombinator.com/submitlink?u=%22+encodeURIComponent(document.location)+%22&amp;amp;t=%22+encodeURIComponent(document.title)" class="hn-link">Discuss on Hacker News</a></div>
          <div class="network twitter"><a https://twitter.com/share data-via="chri_hartmann" data-count="none" class="twitter-share-button">Tweet</a></div>
        </div>
        <div class="nav"><a href="/">« Full blog</a></div>
        <section class="about">
        </section>
        <section class="copy">
          <p>&copy; 2018 Christoph Hartmann &mdash; powered by&nbsp;<a href="https://github.com/jnordberg/wintersmith">Wintersmith</a>
          </p>
        </section>
      </div>
    </footer>
  </body>
</html>